@using Neksara.ViewModels
@{
    var topics = ViewBag.PopularTopics as List<TopicCardVM>;
    int pageSize = 4;
}

<section id="recent-blog-postst" class="recent-blog-postst section light-background" style="background-color:#9fbec2;">
    <div class="container">
        <div class="row align-items-center">

            <!-- LEFT: TITLE -->
            <div class="col-lg-3 d-flex" data-aos="fade-right">
                <div class="section-title topic-title-wrapper">
                    <h2 class="topic-title"
                        style="margin-bottom: 15px !important; padding-bottom: 0 !important; border-bottom: none !important;">
                        <span class="title-main">Topik</span>
                        <span class="title-accent">Paling Populer</span>
                    </h2>

                    <!-- Rating Stars and Count -->
                    @if (topics != null && topics.Any())
                    {
<<<<<<< HEAD
                        var averageRating = topics
                            .Where(t => t.Feedbacks != null && t.Feedbacks.Any())
                            .Select(t => t.Feedbacks.Average(f => f.Rating))
                            .DefaultIfEmpty(0)
                            .Average();
                        
                        <div class="d-flex align-items-center mt-2" style="gap: 8px;">
                            <div class="star-rating">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= Math.Floor(averageRating))
                                    {
                                        <i class="bi bi-star-fill text-warning"></i>
                                    }
                                    else if (i == Math.Ceiling(averageRating) && averageRating % 1 > 0)
                                    {
                                        <i class="bi bi-star-half text-warning"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-star text-warning"></i>
                                    }
                                }
=======
                        var t = topics[i];

                        <div class="col-md-3 popular-topic-item"
                             data-index="@i">
                            <div class="card h-100 shadow-sm">

                                <img src="@t.TopicPicture"
                                     class="card-img-top"
                                     alt="@t.TopicName"
                                     style="height:180px; object-fit:cover;" />

                                <div class="card-body">

                                    <span class="badge bg-secondary mb-2">
                                        @t.CategoryName
                                    </span>

                                    <h6 class="fw-bold mt-2">
                                        @t.TopicName
                                    </h6>

                                    <!-- ‚≠ê RATING -->
                                    <p class="mb-1">
                                        <strong>@t.Rating.ToString("0.0")</strong> / 5
                                        <span class="text-warning ms-1">
                                            @for (int s = 1; s <= 5; s++)
                                            {
                                                if (s <= Math.Floor(t.Rating))
                                                { <text>‚òÖ</text> }
                                                else
                                                { <text>‚òÜ</text> }
                                            }
                                        </span>
                                        <small class="text-muted">
                                            (@t.ReviewCount)
                                        </small>
                                    </p>

                                    <small class="text-muted">
                                        üëÅ @t.ViewCount Views
                                    </small>
                                </div>

                                <div class="card-footer bg-white border-0">
                                    <a href="/Learning/Detail/@t.TopicId"
                                       class="btn btn-sm btn-primary w-100">
                                        üìñ Lihat Materi
                                    </a>
                                </div>

>>>>>>> ab47105e5f79c40375b6296f61d3626beddcbb66
                            </div>
                            <span class="rating-count" style="color: #666; font-size: 14px; font-weight: 600;">
                                @averageRating.ToString("0.0")
                            </span>
                        </div>
                    }
                </div>
            </div>
<<<<<<< HEAD

            <!-- RIGHT: CARD + ARROWS -->
            <div class="col-lg-9">
                <div class="topics-wrapper">

                    @if (topics != null && topics.Any())
                    {
                        <div class="position-relative">
                            <div class="topics-slider">
                                <div class="row gx-4 gy-4 flex-nowrap topics-track" id="topicsTrack">
                                    @for (int i = 0; i < topics.Count; i++)
                                    {
                                        var t = topics[i];
                                        var rating = t.Feedbacks != null && t.Feedbacks.Any()
                                            ? Math.Round(t.Feedbacks.Average(f => f.Rating), 1)
                                            : 0;
                                        var count = t.Feedbacks?.Count ?? 0;

                                        <div class="col-xl-3 col-lg-4 col-md-6 topic-card-item popular-topic-item"
                                             data-index="@i">
                                            <div class="post-item h-100" data-aos="fade-up"
                                                data-aos-delay="@(100 + (i * 100))">

                                                <div class="post-img position-relative overflow-hidden">
                                                    <img src="@t.TopicPicture"
                                                        class="img-fluid" alt="@t.TopicName">
                                                    <span class="post-date">@t.Category?.CategoryName</span>
                                                </div>

                                                <div class="post-content d-flex flex-column">

                                                    <h3 class="post-title">
                                                        @t.TopicName
                                                    </h3>

                                                    <!-- Rating Stars -->
                                                    <div class="post-rating d-flex align-items-center mt-2 mb-3" style="gap: 5px;">
                                                        <div class="star-rating-small">
                                                            @for (int s = 1; s <= 5; s++)
                                                            {
                                                                if (s <= Math.Floor(rating))
                                                                {
                                                                    <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                                                                }
                                                                else if (s == Math.Ceiling(rating) && rating % 1 > 0)
                                                                {
                                                                    <i class="bi bi-star-half text-warning" style="font-size: 14px;"></i>
                                                                }
                                                                else
                                                                {
                                                                    <i class="bi bi-star text-warning" style="font-size: 14px;"></i>
                                                                }
                                                            }
                                                        </div>
                                                        <span class="rating-count-small"
                                                            style="color: #666; font-size: 13px; font-weight: 500;">
                                                            @rating.ToString("0.0")
                                                        </span>
                                                        <span class="review-count"
                                                            style="color: #888; font-size: 12px; margin-left: 3px;">
                                                            (@count)
                                                        </span>
                                                    </div>

                                                    <hr>

                                                    <a href="/Learning/Detail/@t.TopicId" class="readmore stretched-link">
                                                        <span class="learn-now-text">Lihat Materi</span>
                                                        <i class="bi bi-arrow-right"></i>
                                                    </a>

                                                    <div class="meta-bottom">
                                                        <span class="meta-view">
                                                            <i class="bi bi-eye"></i>
                                                            <span class="meta-text">@t.ViewCount dilihat</span>
                                                        </span>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Gunakan topics-arrows-center -->
                            <div class="topics-arrows-center">
                                <button class="arrow-btn prev" id="btnPrev">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <button class="arrow-btn next active" id="btnNext">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>

                            <!-- DOT PAGINATION -->
                            <div class="d-flex justify-content-center mt-4 gap-2" id="topicDots"></div>

                        </div>
                    }
                    else
                    {
                        <div class="topics-slider">
                            <div class="row gx-4 gy-4 flex-nowrap topics-track">
                                <div class="col-xl-3 col-lg-4 col-md-6 topic-card-item" data-aos="fade-up"
                                    data-aos-delay="400">
                                    <div class="post-item h-100">

                                        <div class="post-img position-relative overflow-hidden">
                                            <img src="~/assets/img/blog/blog-1.jpg"
                                                class="img-fluid" alt="">
                                            <span class="post-date">Frontend</span>
                                        </div>

                                        <div class="post-content d-flex flex-column">

                                            <h3 class="post-title">
                                                Panduan Pemula untuk Menjadi Frontend Profesional
                                            </h3>

                                            <!-- Rating Stars -->
                                            <div class="post-rating d-flex align-items-center mt-2 mb-3" style="gap: 5px;">
                                                <div class="star-rating-small">
                                                    <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                                                    <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                                                    <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                                                    <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                                                    <i class="bi bi-star-half text-warning" style="font-size: 14px;"></i>
                                                </div>
                                                <span class="rating-count-small"
                                                    style="color: #666; font-size: 13px; font-weight: 500;">
                                                    4.5
                                                </span>
                                                <span class="review-count"
                                                    style="color: #888; font-size: 12px; margin-left: 3px;">
                                                    (120)
                                                </span>
                                            </div>

                                            <hr>

                                            <a href="blog-details.html" class="readmore stretched-link">
                                                <span class="learn-now-text">Lihat Materi</span>
                                                <i class="bi bi-arrow-right"></i>
                                            </a>

                                            <div class="meta-bottom">
                                                <span class="meta-view">
                                                    <span class="meta-text">400 view</span>
                                                    <i class="bi bi-eye"></i>
                                                </span>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="topics-arrows-center">
                                <button class="arrow-btn prev">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <button class="arrow-btn next active">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    }

                </div>
            </div>

        </div>
=======
        }
        else
        {
            <p class="text-muted">Belum ada topik populer.</p>
        }
>>>>>>> ab47105e5f79c40375b6296f61d3626beddcbb66
    </div>
</section>
